<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../resources/report.css" type="text/css"/><link rel="shortcut icon" href="../resources/report.gif" type="image/gif"/><title>MainPresenterImpl.java</title><link rel="stylesheet" href="../resources/prettify.css" type="text/css"/><script type="text/javascript" src="../resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">app</a> &gt; <a href="index.source.html" class="el_package">deltagraphs.norrisviewer.presenter.mainPresenter</a> &gt; <span class="el_source">MainPresenterImpl.java</span></div><h1>MainPresenterImpl.java</h1><pre class="source lang-java linenums">package deltagraphs.norrisviewer.presenter.mainPresenter;


    import android.app.Activity;
    import android.app.AlertDialog;
    import android.content.Context;
    import android.content.DialogInterface;
    import android.content.Intent;
    import android.os.Bundle;
    import android.text.InputType;
    import android.view.LayoutInflater;
    import android.view.View;
    import android.view.ViewGroup;
    import android.widget.AdapterView;
    import android.widget.ArrayAdapter;
    import android.widget.EditText;
    import android.support.v4.app.Fragment;
    import android.support.v4.app.FragmentManager;
    import android.widget.FrameLayout;
    import android.widget.ListView;
    import android.widget.TextView;

    import deltagraphs.norrisviewer.R;

    import java.util.ArrayList;
    import java.util.List;

    import deltagraphs.norrisviewer.model.pageModel.*;
    import deltagraphs.norrisviewer.presenter.SocketManager;
    import deltagraphs.norrisviewer.view.graphsView.LineChartActivity;
    import deltagraphs.norrisviewer.view.mainView.MainView;
    import deltagraphs.norrisviewer.view.mainView.PageNavigationFragment;

    import lecho.lib.hellocharts.view.AbstractChartView;
    import lecho.lib.hellocharts.view.Chart;
    import lecho.lib.hellocharts.view.ColumnChartView;
    import lecho.lib.hellocharts.view.LineChartView;
    import lecho.lib.hellocharts.view.PreviewLineChartView;


/*
 * Name : MainPresenterImpl.java
 * Module : norrisviewer::presenter::mainPresenter
 * Location : norrisviewer\presenter\mainPresenter
 *
 * History :

 * Version Date Programmer Description
 * ===============================================================
 *
 * 0.0.1 2015-05-13 Davide Trivellato Creazione file
 *
 * ===============================================================
 *
 */

public class MainPresenterImpl implements MainPresenter,PageNavigationFragment.NavigationDrawerCallbacks {

    private static SocketManager mainSocket;
    private MainView mainView;
    private PageNavigationFragment mPageNavigationFragment;
<span class="nc" id="L62">    private PageModel pageModel = new PageModelImpl();</span>

<span class="nc" id="L64">    public MainPresenterImpl(MainView view){</span>
<span class="nc" id="L65">        mainSocket = new SocketManager();</span>
<span class="nc" id="L66">        mainView = view;</span>
<span class="nc" id="L67">        mPageNavigationFragment = new PageNavigationFragment();</span>
<span class="nc" id="L68">        setUpViews();</span>
<span class="nc" id="L69">    }</span>

    private void setUpViews(){
<span class="nc" id="L72">        mainView.setMainView();</span>
<span class="nc" id="L73">        mPageNavigationFragment = mainView.getFragment(R.id.navigation_drawer);</span>

<span class="nc" id="L75">        mPageNavigationFragment.setUp(</span>
                R.id.navigation_drawer,
                mainView.findDrawer(R.id.drawer_layout));
<span class="nc" id="L78">    }</span>

    public void showDialog(Context context){
<span class="nc" id="L81">        AlertDialog.Builder builder = new AlertDialog.Builder(context);</span>
<span class="nc" id="L82">        builder.setTitle(&quot;Insert source URL&quot;);</span>

        // Set up the input
<span class="nc" id="L85">        final EditText input = new EditText(context);</span>
// Specify the type of input expected; this, for example, sets the input as a password, and will mask the text
<span class="nc" id="L87">        input.setInputType(InputType.TYPE_CLASS_TEXT);</span>
<span class="nc" id="L88">        input.setText(&quot;http://5.231.33.217:3000/page1&quot;);</span>
<span class="nc" id="L89">        builder.setView(input);</span>

// Set up the buttons
<span class="nc" id="L92">        builder.setPositiveButton(&quot;OK&quot;, new DialogInterface.OnClickListener() {</span>
            @Override
            public void onClick(DialogInterface dialog, int which) {
<span class="nc" id="L95">                mainSocket.setSocketUrl(input.getText().toString());</span>
<span class="nc" id="L96">            }</span>
        });
<span class="nc" id="L98">        builder.setNegativeButton(&quot;Cancel&quot;, new DialogInterface.OnClickListener() {</span>
            @Override
            public void onClick(DialogInterface dialog, int which) {
<span class="nc" id="L101">                dialog.cancel();</span>
<span class="nc" id="L102">            }</span>
        });

<span class="nc" id="L105">        builder.show();</span>
<span class="nc" id="L106">    }</span>

    @Override
    public void onNavigationDrawerItemSelected(int position) {
        // update the main content by replacing fragments
<span class="nc" id="L111">        FragmentManager fragmentManager = mainView.getSupportManager();</span>
<span class="nc" id="L112">        fragmentManager.beginTransaction()</span>
                .replace(R.id.container, PlaceholderFragment.newInstance(position + 1, pageModel))
                .commit();
<span class="nc" id="L115">    }</span>



    //QUESTO GESTISCE IL FRAGMENT DOVE ANDRANNO INSERITI I GRAFICI



    /**
     * A placeholder fragment containing a simple view.
     */
    public static class PlaceholderFragment extends Fragment implements AdapterView.OnItemClickListener {

        private ListView listView;
        private ChartAdapter adapter;
        private PageModel pageModel;
<span class="nc" id="L131">        private List&lt;ChartDescription&gt; graphsList = new ArrayList&lt;ChartDescription&gt;();</span>

        /**
         * The fragment argument representing the section number for this
         * fragment.
         */
        private static final String ARG_SECTION_NUMBER = &quot;section_number&quot;;

        /**
         * Returns a new instance of this fragment for the given section
         * number.
         */



        public static PlaceholderFragment newInstance(int sectionNumber, PageModel p) {
<span class="nc" id="L147">            PlaceholderFragment fragment = new PlaceholderFragment();</span>
<span class="nc" id="L148">            Bundle args = new Bundle();</span>
<span class="nc" id="L149">            args.putInt(ARG_SECTION_NUMBER, sectionNumber);</span>
<span class="nc" id="L150">            fragment.setArguments(args);</span>
<span class="nc" id="L151">            fragment.pageModel = p;</span>
<span class="nc" id="L152">            return fragment;</span>
        }

<span class="nc" id="L155">        public PlaceholderFragment() {}</span>

        @Override
        public View onCreateView(LayoutInflater inflater, ViewGroup container,
                                 Bundle savedInstanceState) {
<span class="nc" id="L160">            View rootView = inflater.inflate(R.layout.fragment_main, container, false);</span>
<span class="nc" id="L161">            listView = (ListView) rootView.findViewById(android.R.id.list);</span>
<span class="nc" id="L162">            graphsList = generateDescriptions();</span>
<span class="nc" id="L163">            adapter = new ChartAdapter(getActivity(), 0, graphsList);</span>
<span class="nc" id="L164">            listView.setAdapter(adapter);</span>
<span class="nc" id="L165">            listView.setOnItemClickListener(this);</span>
<span class="nc" id="L166">            return rootView;</span>
        }
/*
        @Override
        public void onAttach(Activity activity) {
            super.onAttach(activity);
            ((MainActivity) activity).onSectionAttached(
                    getArguments().getInt(ARG_SECTION_NUMBER));
        }
*/
        @Override
        public void onItemClick(AdapterView&lt;?&gt; adapter, View view, int position, long id) {
            Intent intent;
<span class="nc bnc" id="L179" title="All 2 branches missed.">            switch (position) {</span>
                case 0:
                   //  Line Chart;
<span class="nc" id="L182">                    intent = new Intent(getActivity(), LineChartActivity.class);</span>
<span class="nc" id="L183">                    intent.putExtra(&quot;EXTRA_SOURCE_URL&quot;, graphsList.get(position).getUrl());</span>
<span class="nc" id="L184">                    startActivity(intent);</span>
<span class="nc" id="L185">                    break;</span>

                case 1:
                    // Column Chart;
                  //  intent = new Intent(getActivity(), MapChartActivity.class);
                   // startActivity(intent);
                   // break;
                /*
                case 2:
                    // Pie Chart;
                    intent = new Intent(getActivity(), PieChartActivity.class);
                    startActivity(intent);
                    break;
                    */
                default:
                    break;
            }
<span class="nc" id="L202">        }</span>


        // this is generated after socket connection with the graphs' list

        private List&lt;ChartDescription&gt; generateDescriptions() {
<span class="nc" id="L208">            List&lt;ChartDescription&gt; list = new ArrayList&lt;ChartDescription&gt;();</span>

            //number of page needed
<span class="nc" id="L211">            int PAGE = 1;</span>

<span class="nc" id="L213">            int size = pageModel.getItemListSize(PAGE);</span>
<span class="nc" id="L214">            ArrayList&lt;PageItem&gt; itemList = pageModel.getItemList(PAGE);</span>
<span class="nc bnc" id="L215" title="All 2 branches missed.">            for(int i=0; i&lt;size; i++) {</span>
<span class="nc" id="L216">                String itemName = itemList.get(i).getName();</span>
<span class="nc" id="L217">                String itemType = itemList.get(i).getType();</span>
<span class="nc" id="L218">                String itemUrl = itemList.get(i).getUrl();</span>
<span class="nc" id="L219">                list.add(new ChartDescription(itemName, itemType, itemUrl, ChartType.COLUMN_CHART));</span>
            }
<span class="nc" id="L221">            return list;</span>
        }

    }



    public static class ChartAdapter extends ArrayAdapter&lt;ChartDescription&gt; {

        public ChartAdapter(Context context, int resource, List&lt;ChartDescription&gt; objects) {
<span class="nc" id="L231">            super(context, resource, objects);</span>
<span class="nc" id="L232">        }</span>

        @Override
        public View getView(int position, View convertView, ViewGroup parent) {
            ViewHolder holder;

<span class="nc bnc" id="L238" title="All 2 branches missed.">            if (convertView == null) {</span>
<span class="nc" id="L239">                convertView = View.inflate(getContext(), R.layout.list_item_sample, null);</span>

<span class="nc" id="L241">                holder = new ViewHolder();</span>
<span class="nc" id="L242">                holder.text1 = (TextView) convertView.findViewById(R.id.text1);</span>
<span class="nc" id="L243">                holder.text2 = (TextView) convertView.findViewById(R.id.text2);</span>
<span class="nc" id="L244">                holder.chartLayout = (FrameLayout) convertView.findViewById(R.id.chart_layout);</span>

<span class="nc" id="L246">                convertView.setTag(holder);</span>
            } else {
<span class="nc" id="L248">                holder = (ViewHolder) convertView.getTag();</span>
            }

<span class="nc" id="L251">            ChartDescription item = getItem(position);</span>

<span class="nc" id="L253">            String graphUrl = item.getUrl();</span>

<span class="nc" id="L255">            holder.chartLayout.setVisibility(View.VISIBLE);</span>
<span class="nc" id="L256">            holder.chartLayout.removeAllViews();</span>
            AbstractChartView chart;
<span class="nc bnc" id="L258" title="All 4 branches missed.">            switch (item.chartType) {</span>
                case LINE_CHART:
<span class="nc" id="L260">                    chart = new LineChartView(getContext());</span>
<span class="nc" id="L261">                    holder.chartLayout.addView(chart);</span>
<span class="nc" id="L262">                    break;</span>
                case COLUMN_CHART:
<span class="nc" id="L264">                    chart = new ColumnChartView(getContext());</span>
<span class="nc" id="L265">                    holder.chartLayout.addView(chart);</span>
<span class="nc" id="L266">                    break;</span>
                case PREVIEW_LINE_CHART:
<span class="nc" id="L268">                    chart = new PreviewLineChartView(getContext());</span>
<span class="nc" id="L269">                    holder.chartLayout.addView(chart);</span>
<span class="nc" id="L270">                    break;</span>
                default:
<span class="nc" id="L272">                    chart = null;</span>
<span class="nc" id="L273">                    holder.chartLayout.setVisibility(View.GONE);</span>
                    break;
            }

<span class="nc bnc" id="L277" title="All 2 branches missed.">            if (null != chart) {</span>
<span class="nc" id="L278">                chart.setInteractive(false);// Disable touch handling for chart on the ListView.</span>
            }
<span class="nc" id="L280">            holder.text1.setText(item.text1);</span>
<span class="nc" id="L281">            holder.text2.setText(item.text2);</span>

<span class="nc" id="L283">            return convertView;</span>
        }

<span class="nc" id="L286">        private class ViewHolder {</span>

            TextView text1;
            TextView text2;
            FrameLayout chartLayout;
        }

    }

<span class="nc" id="L295">    public enum ChartType {</span>
<span class="nc" id="L296">        LINE_CHART, COLUMN_CHART, PREVIEW_LINE_CHART, OTHER</span>
    }

    public static class ChartDescription {
        private String text1;
        private String text2;
        private String url;
        private ChartType chartType;

<span class="nc" id="L305">        public String getUrl(){return url;}</span>
<span class="nc" id="L306">        public String getText1() {return text1;}</span>
<span class="nc" id="L307">        public String getText2() {return text2;}</span>

<span class="nc" id="L309">        public ChartDescription(String text1, String text2, String url, ChartType chartType) {</span>
<span class="nc" id="L310">            this.text1 = text1;</span>
<span class="nc" id="L311">            this.text2 = text2;</span>
<span class="nc" id="L312">            this.chartType = chartType;</span>
<span class="nc" id="L313">        }</span>
    }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.4.201502262128</span></div></body></html>