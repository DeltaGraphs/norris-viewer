<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../resources/report.css" type="text/css"/><link rel="shortcut icon" href="../resources/report.gif" type="image/gif"/><title>MainPresenterImpl.java</title><link rel="stylesheet" href="../resources/prettify.css" type="text/css"/><script type="text/javascript" src="../resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">app</a> &gt; <a href="index.source.html" class="el_package">deltagraphs.norrisviewer.presenter.mainPresenter</a> &gt; <span class="el_source">MainPresenterImpl.java</span></div><h1>MainPresenterImpl.java</h1><pre class="source lang-java linenums">package deltagraphs.norrisviewer.presenter.mainPresenter;


import android.app.AlertDialog;
import android.content.Context;
import android.content.DialogInterface;
import android.text.InputType;
import android.widget.EditText;

import java.util.Observable;
import java.util.Observer;

import deltagraphs.norrisviewer.model.pageModel.*;
import deltagraphs.norrisviewer.presenter.SocketManager;
import deltagraphs.norrisviewer.view.mainView.MainActivity;
import deltagraphs.norrisviewer.view.mainView.MainView;


/*
 * Name : MainPresenterImpl.java
 * Module : norrisviewer::presenter::mainPresenter
 * Location : norrisviewer\presenter\mainPresenter
 *
 * History :

 * Version Date Programmer Description
 * ===============================================================
 *
 * 0.3.2 2015-05-21 Davide Trivellato Added methods isConnected() and boolean isSocketNull()
 *
 * 0.3.1 2015-05-21 Davide Trivellato Fixes to connection methods
 *
 * 0.3.0 2015-05-20 Davide Trivellato Major changes to the whole class
 *
 * 0.2.0 2015-05-19 Davide Trivellato Add dialog to insert URl
 *
 * 0.1.0 2015-05-19 Davide Trivellato Coding of all methods and attributes
 *
 * 0.0.1 2015-05-19 Davide Trivellato Creation of the file
 *
 * ===============================================================
 *
 */

public class MainPresenterImpl implements MainPresenter, Observer {

    protected SocketManager mainSocket;
    public MainView mainView;
<span class="fc" id="L49">    protected PageModel pageModel = new PageModelImpl(this);</span>

<span class="fc" id="L51">    public MainPresenterImpl(MainView view) {</span>
<span class="fc" id="L52">        mainSocket = new SocketManager();</span>
<span class="fc" id="L53">        mainView = view;</span>
<span class="fc" id="L54">    }</span>

    public void setUpSocket(String url) {
<span class="fc" id="L57">        mainSocket.setSocketUrl(url);</span>
<span class="fc" id="L58">        mainSocket.startListening(&quot;configPageList&quot;, (MainActivity) mainView, pageModel);</span>
<span class="fc" id="L59">        mainSocket.startListening(&quot;insertPage&quot;, (MainActivity) mainView, pageModel);</span>
<span class="fc" id="L60">        mainSocket.startListening(&quot;updatePage&quot;, (MainActivity) mainView, pageModel);</span>
<span class="fc" id="L61">        mainSocket.startListening(&quot;insertGraph&quot;, (MainActivity) mainView, pageModel);</span>
<span class="fc" id="L62">        mainSocket.startListening(&quot;updateGraph&quot;, (MainActivity) mainView, pageModel);</span>
<span class="fc" id="L63">        mainSocket.startConnection();</span>
<span class="fc" id="L64">    }</span>

    public void reinitializePageList() {
<span class="fc" id="L67">        pageModel = new PageModelImpl(this);</span>
<span class="fc" id="L68">    }</span>

    public AlertDialog showDialog(final Context context) {
<span class="nc" id="L71">        AlertDialog.Builder builder = new AlertDialog.Builder(context);</span>
<span class="nc" id="L72">        builder.setTitle(&quot;Insert source URL&quot;);</span>

        // Set up the input
<span class="nc" id="L75">        final EditText input = new EditText(context);</span>
        // Specify the type of input expected; this, for example, sets the input as a password, and will mask the text
<span class="nc" id="L77">        input.setInputType(InputType.TYPE_CLASS_TEXT);</span>
        //input.setText(&quot;http://norris-nrti-dev.herokuapp.com/page1/map1&quot;);
<span class="nc" id="L79">        input.setText(&quot;http://norris-nrti-dev.herokuapp.com/norris&quot;);</span>
<span class="nc" id="L80">        builder.setView(input);</span>

        // Set up the buttons
<span class="nc" id="L83">        builder.setPositiveButton(&quot;OK&quot;, new DialogInterface.OnClickListener() {</span>
            @Override
            public void onClick(DialogInterface dialog, int which) {
<span class="nc bnc" id="L86" title="All 2 branches missed.">                if (!(input.getText().toString().equals(mainSocket.getSocketUrl()))) {</span>
<span class="nc bnc" id="L87" title="All 4 branches missed.">                    if ((!mainSocket.isNull()) &amp;&amp; (mainSocket.isConnected())) {</span>
<span class="nc" id="L88">                        pageModel.removeObservers();</span>
<span class="nc" id="L89">                        mainSocket.stopConnection();</span>
<span class="nc" id="L90">                        mainSocket = new SocketManager();</span>
<span class="nc" id="L91">                        reinitializePageList();</span>
                    }
<span class="nc" id="L93">                    setUpSocket(input.getText().toString());</span>
                }
<span class="nc" id="L95">            }</span>
        });
<span class="nc" id="L97">        builder.setNegativeButton(&quot;Cancel&quot;, new DialogInterface.OnClickListener() {</span>
            @Override
            public void onClick(DialogInterface dialog, int which) {
<span class="nc" id="L100">                dialog.cancel();</span>
<span class="nc" id="L101">            }</span>
        });

<span class="nc" id="L104">        AlertDialog dialog = builder.show();</span>
<span class="nc" id="L105">        return dialog;</span>
    }

    @Override
    public void stopConnection() {
<span class="fc" id="L110">        mainSocket.stopConnection();</span>
<span class="fc" id="L111">    }</span>

    @Override
    public void destroyConnection() {
<span class="fc" id="L115">        mainSocket.destroyConnection();</span>
<span class="fc" id="L116">    }</span>

    @Override
    public void startConnection() {
<span class="fc" id="L120">        mainSocket.startConnection();</span>
<span class="fc" id="L121">    }</span>

    @Override
    public boolean isConnected() {
<span class="fc" id="L125">        return mainSocket.isConnected();</span>
    }

    @Override
    public boolean isSocketNull() {
<span class="fc" id="L130">        return mainSocket.isNull();</span>
    }

    @Override
    public void update(Observable observable, Object data) {
<span class="fc" id="L135">        mainView.updatePagesList(pageModel);</span>
<span class="fc" id="L136">    }</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.4.201502262128</span></div></body></html>