<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../resources/report.css" type="text/css"/><link rel="shortcut icon" href="../resources/report.gif" type="image/gif"/><title>MainPresenterImpl.java</title><link rel="stylesheet" href="../resources/prettify.css" type="text/css"/><script type="text/javascript" src="../resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">app</a> &gt; <a href="index.source.html" class="el_package">deltagraphs.norrisviewer.presenter.mainPresenter</a> &gt; <span class="el_source">MainPresenterImpl.java</span></div><h1>MainPresenterImpl.java</h1><pre class="source lang-java linenums">package deltagraphs.norrisviewer.presenter.mainPresenter;


    import android.app.AlertDialog;
    import android.content.Context;
    import android.content.DialogInterface;
    import android.content.Intent;
    import android.os.Bundle;
    import android.text.InputType;
    import android.view.LayoutInflater;
    import android.view.View;
    import android.view.ViewGroup;
    import android.widget.AdapterView;
    import android.widget.ArrayAdapter;
    import android.widget.EditText;
    import android.support.v4.app.Fragment;
    import android.support.v4.app.FragmentManager;
    import android.widget.FrameLayout;
    import android.widget.ListView;
    import android.widget.TextView;

    import deltagraphs.norrisviewer.R;

    import java.util.ArrayList;
    import java.util.List;

    import deltagraphs.norrisviewer.model.pageModel.*;
    import deltagraphs.norrisviewer.presenter.SocketManager;
    import deltagraphs.norrisviewer.view.graphsView.*;
    import deltagraphs.norrisviewer.view.mainView.MainView;
    import deltagraphs.norrisviewer.view.mainView.PageNavigationFragment;

    import lecho.lib.hellocharts.view.AbstractChartView;
    import lecho.lib.hellocharts.view.ColumnChartView;
    import lecho.lib.hellocharts.view.LineChartView;
    import lecho.lib.hellocharts.view.PreviewLineChartView;


/*
 * Name : MainPresenterImpl.java
 * Module : norrisviewer::presenter::mainPresenter
 * Location : norrisviewer\presenter\mainPresenter
 *
 * History :

 * Version Date Programmer Description
 * ===============================================================
 *
 * 0.0.1 2015-05-13 Davide Trivellato Creazione file
 *
 * ===============================================================
 *
 */

public class MainPresenterImpl implements MainPresenter,PageNavigationFragment.NavigationDrawerCallbacks {

    private static SocketManager mainSocket;
    public static MainView mainView;
    private PageNavigationFragment mPageNavigationFragment;
<span class="nc" id="L60">    private PageModel pageModel = new PageModelImpl();</span>

<span class="nc" id="L62">    public MainPresenterImpl(MainView view){</span>
<span class="nc" id="L63">        mainSocket = new SocketManager();</span>
<span class="nc" id="L64">        mainView = view;</span>
<span class="nc" id="L65">        mPageNavigationFragment = new PageNavigationFragment();</span>
<span class="nc" id="L66">        setUpViews();</span>

        //X DEMO
<span class="nc" id="L69">        FragmentManager fragmentManager = mainView.getSupportManager();</span>
<span class="nc" id="L70">        fragmentManager.beginTransaction()</span>
                .replace(R.id.container, PlaceholderFragment.newInstance(1, pageModel))
                .commit();
<span class="nc" id="L73">    }</span>

    private void setUpViews(){
<span class="nc" id="L76">        mainView.setMainView();</span>
<span class="nc" id="L77">        mPageNavigationFragment = mainView.getFragment(R.id.navigation_drawer);</span>

<span class="nc" id="L79">        mPageNavigationFragment.setUp(</span>
                R.id.navigation_drawer,
                mainView.findDrawer(R.id.drawer_layout));
<span class="nc" id="L82">    }</span>

/*
    public void onSectionAttached(int number) {
        if((number-1)&lt;pagesList.length) {
            mTitle = pagesList[number-1];
        }
    }
*/

    public void showDialog(Context context){
<span class="nc" id="L93">        AlertDialog.Builder builder = new AlertDialog.Builder(context);</span>
<span class="nc" id="L94">        builder.setTitle(&quot;Insert source URL&quot;);</span>

        // Set up the input
<span class="nc" id="L97">        final EditText input = new EditText(context);</span>
// Specify the type of input expected; this, for example, sets the input as a password, and will mask the text
<span class="nc" id="L99">        input.setInputType(InputType.TYPE_CLASS_TEXT);</span>
<span class="nc" id="L100">        input.setText(&quot;http://5.231.33.217:3000/page1&quot;);</span>
<span class="nc" id="L101">        builder.setView(input);</span>

// Set up the buttons
<span class="nc" id="L104">        builder.setPositiveButton(&quot;OK&quot;, new DialogInterface.OnClickListener() {</span>
            @Override
            public void onClick(DialogInterface dialog, int which) {
<span class="nc" id="L107">                mainSocket.setSocketUrl(input.getText().toString());</span>
<span class="nc" id="L108">            }</span>
        });
<span class="nc" id="L110">        builder.setNegativeButton(&quot;Cancel&quot;, new DialogInterface.OnClickListener() {</span>
            @Override
            public void onClick(DialogInterface dialog, int which) {
<span class="nc" id="L113">                dialog.cancel();</span>
<span class="nc" id="L114">            }</span>
        });

<span class="nc" id="L117">        builder.show();</span>
<span class="nc" id="L118">    }</span>

    @Override
    public void onNavigationDrawerItemSelected(int position) {
        // update the main content by replacing fragments
<span class="nc" id="L123">        FragmentManager fragmentManager = mainView.getSupportManager();</span>
<span class="nc" id="L124">        fragmentManager.beginTransaction()</span>
                .replace(R.id.container, PlaceholderFragment.newInstance(position + 1, pageModel))
                .commit();
<span class="nc" id="L127">    }</span>



    //QUESTO GESTISCE IL FRAGMENT DOVE ANDRANNO INSERITI I GRAFICI



    /**
     * A placeholder fragment containing a simple view.
     */
    public static class PlaceholderFragment extends Fragment implements AdapterView.OnItemClickListener {

        private ListView listView;
        private ChartAdapter adapter;
        private PageModel pageModel;
<span class="nc" id="L143">        private List&lt;ChartDescription&gt; graphsList = new ArrayList&lt;ChartDescription&gt;();</span>


        /**
         * The fragment argument representing the section number for this
         * fragment.
         */
        private static final String ARG_SECTION_NUMBER = &quot;section_number&quot;;

        /**
         * Returns a new instance of this fragment for the given section
         * number.
         */


        public static PlaceholderFragment newInstance(int sectionNumber, PageModel p) {
<span class="nc" id="L159">            PlaceholderFragment fragment = new PlaceholderFragment();</span>
<span class="nc" id="L160">            Bundle args = new Bundle();</span>
<span class="nc" id="L161">            args.putInt(ARG_SECTION_NUMBER, sectionNumber);</span>
<span class="nc" id="L162">            fragment.setArguments(args);</span>
<span class="nc" id="L163">            fragment.pageModel = p;</span>
<span class="nc" id="L164">            return fragment;</span>
        }

<span class="nc" id="L167">        public PlaceholderFragment() {}</span>

        @Override
        public View onCreateView(LayoutInflater inflater, ViewGroup container,
                                 Bundle savedInstanceState) {
<span class="nc" id="L172">            View rootView = inflater.inflate(R.layout.fragment_main, container, false);</span>
<span class="nc" id="L173">            listView = (ListView) rootView.findViewById(android.R.id.list);</span>
<span class="nc" id="L174">            graphsList = generateDescriptions();</span>
<span class="nc" id="L175">            adapter = new ChartAdapter(getActivity(), 0, graphsList);</span>
<span class="nc" id="L176">            listView.setAdapter(adapter);</span>
<span class="nc" id="L177">            listView.setOnItemClickListener(this);</span>
<span class="nc" id="L178">            return rootView;</span>
        }
/*
        @Override
        public void onAttach(Activity activity) {
            super.onAttach(activity);
            ((MainActivity) activity).onSectionAttached(
                    getArguments().getInt(ARG_SECTION_NUMBER));
        }
*/
        @Override
        public void onItemClick(AdapterView&lt;?&gt; adapter, View view, int position, long id) {
            Intent intent;
<span class="nc" id="L191">            ChartType graphType = graphsList.get(position).getChartType();</span>
<span class="nc bnc" id="L192" title="All 5 branches missed.">            switch (graphType) {</span>
                case LINE_CHART:
<span class="nc" id="L194">                    intent = new Intent(getActivity(), LineChartActivity.class);</span>
<span class="nc" id="L195">                    intent.putExtra(&quot;EXTRA_SOURCE_URL&quot;, graphsList.get(position).getUrl());</span>
<span class="nc" id="L196">                    intent.putExtra(&quot;EXTRA_SOURCE_TITLE&quot;, graphsList.get(position).getName());</span>
<span class="nc" id="L197">                    startActivity(intent);</span>
<span class="nc" id="L198">                    break;</span>

                case COLUMN_CHART:
<span class="nc" id="L201">                    intent = new Intent(getActivity(), BarChartActivity.class);</span>
<span class="nc" id="L202">                    intent.putExtra(&quot;EXTRA_SOURCE_URL&quot;, graphsList.get(position).getUrl());</span>
<span class="nc" id="L203">                    intent.putExtra(&quot;EXTRA_SOURCE_TITLE&quot;, graphsList.get(position).getName());</span>
<span class="nc" id="L204">                    startActivity(intent);</span>
<span class="nc" id="L205">                    break;</span>

                case MAP_CHART:
<span class="nc" id="L208">                    intent = new Intent(getActivity(), MapChartActivity.class);</span>
<span class="nc" id="L209">                    intent.putExtra(&quot;EXTRA_SOURCE_URL&quot;, graphsList.get(position).getUrl());</span>
<span class="nc" id="L210">                    intent.putExtra(&quot;EXTRA_SOURCE_TITLE&quot;, graphsList.get(position).getName());</span>
<span class="nc" id="L211">                    startActivity(intent);</span>
<span class="nc" id="L212">                    break;</span>
                case TABLE:
<span class="nc" id="L214">                    intent = new Intent(getActivity(), TableActivity.class);</span>
<span class="nc" id="L215">                    intent.putExtra(&quot;EXTRA_SOURCE_URL&quot;, graphsList.get(position).getUrl());</span>
<span class="nc" id="L216">                    intent.putExtra(&quot;EXTRA_SOURCE_TITLE&quot;, graphsList.get(position).getName());</span>
<span class="nc" id="L217">                    startActivity(intent);</span>
<span class="nc" id="L218">                    break;</span>
                default:
                    break;
            }
<span class="nc" id="L222">        }</span>


        // this is generated after socket connection with the graphs' list

        private List&lt;ChartDescription&gt; generateDescriptions() {
<span class="nc" id="L228">            List&lt;ChartDescription&gt; list = new ArrayList&lt;ChartDescription&gt;();</span>
/*
            //number of page needed
            int PAGE = 1;

            int size = pageModel.getItemListSize(PAGE);
            ArrayList&lt;PageItem&gt; itemList = pageModel.getItemList(PAGE);
            for(int i=0; i&lt;size; i++) {
                String itemName = itemList.get(i).getName();
                String itemType = itemList.get(i).getType();
                String itemUrl = itemList.get(i).getUrl();
                list.add(new ChartDescription(itemName, itemType, itemUrl, ChartType.COLUMN_CHART));
            }
            */

<span class="nc" id="L243">            list.add(new ChartDescription(&quot;BalbyChartBar&quot;, &quot;bablgbn&quot;, &quot;asdasd&quot;, ChartType.COLUMN_CHART));</span>
<span class="nc" id="L244">            list.add(new ChartDescription(&quot;linebalby&quot;, &quot;asd&quot;, &quot;asd&quot;, ChartType.LINE_CHART));</span>
<span class="nc" id="L245">            list.add(new ChartDescription(&quot;MappaDemmedda&quot;, &quot;ciao&quot;, &quot;Colpa di ross&quot;, ChartType.MAP_CHART));</span>
<span class="nc" id="L246">            list.add(new ChartDescription(&quot;tabbbbella&quot;, &quot;tabble&quot;, &quot;url&quot;, ChartType.TABLE));</span>


<span class="nc" id="L249">            return list;</span>
        }

    }



    public static class ChartAdapter extends ArrayAdapter&lt;ChartDescription&gt; {

        public ChartAdapter(Context context, int resource, List&lt;ChartDescription&gt; objects) {
<span class="nc" id="L259">            super(context, resource, objects);</span>
<span class="nc" id="L260">        }</span>

        @Override
        public View getView(int position, View convertView, ViewGroup parent) {
            ViewHolder holder;

<span class="nc bnc" id="L266" title="All 2 branches missed.">            if (convertView == null) {</span>
<span class="nc" id="L267">                convertView = View.inflate(getContext(), R.layout.list_item_sample, null);</span>

<span class="nc" id="L269">                holder = new ViewHolder();</span>
<span class="nc" id="L270">                holder.name = (TextView) convertView.findViewById(R.id.name);</span>
<span class="nc" id="L271">                holder.type = (TextView) convertView.findViewById(R.id.type);</span>
<span class="nc" id="L272">                holder.chartLayout = (FrameLayout) convertView.findViewById(R.id.chart_layout);</span>

<span class="nc" id="L274">                convertView.setTag(holder);</span>
            } else {
<span class="nc" id="L276">                holder = (ViewHolder) convertView.getTag();</span>
            }

<span class="nc" id="L279">            ChartDescription item = getItem(position);</span>

<span class="nc" id="L281">            String graphUrl = item.getUrl();</span>

<span class="nc" id="L283">            holder.chartLayout.setVisibility(View.VISIBLE);</span>
<span class="nc" id="L284">            holder.chartLayout.removeAllViews();</span>
            AbstractChartView chart;
<span class="nc bnc" id="L286" title="All 6 branches missed.">            switch (item.chartType) {</span>
                case LINE_CHART:
<span class="nc" id="L288">                    chart = new LineChartView(getContext());</span>
<span class="nc" id="L289">                    holder.chartLayout.addView(chart);</span>
<span class="nc" id="L290">                    break;</span>
                case COLUMN_CHART:
<span class="nc" id="L292">                    chart = new ColumnChartView(getContext());</span>
<span class="nc" id="L293">                    holder.chartLayout.addView(chart);</span>
<span class="nc" id="L294">                    break;</span>
                case PREVIEW_LINE_CHART:
<span class="nc" id="L296">                    chart = new PreviewLineChartView(getContext());</span>
<span class="nc" id="L297">                    holder.chartLayout.addView(chart);</span>
<span class="nc" id="L298">                    break;</span>
                case MAP_CHART:
<span class="nc" id="L300">                    chart = new PreviewLineChartView(getContext());</span>
<span class="nc" id="L301">                    holder.chartLayout.addView(chart);</span>
<span class="nc" id="L302">                    break;</span>
                case TABLE:
<span class="nc" id="L304">                    chart = new PreviewLineChartView(getContext());</span>
<span class="nc" id="L305">                    holder.chartLayout.addView(chart);</span>
<span class="nc" id="L306">                    break;</span>
                default:
<span class="nc" id="L308">                    chart = null;</span>
<span class="nc" id="L309">                    holder.chartLayout.setVisibility(View.GONE);</span>
                    break;
            }

<span class="nc bnc" id="L313" title="All 2 branches missed.">            if (null != chart) {</span>
<span class="nc" id="L314">                chart.setInteractive(false);// Disable touch handling for chart on the ListView.</span>
            }
<span class="nc" id="L316">            holder.name.setText(item.name);</span>
<span class="nc" id="L317">            holder.type.setText(item.type);</span>

<span class="nc" id="L319">            return convertView;</span>
        }

<span class="nc" id="L322">        private class ViewHolder {</span>

            TextView name;
            TextView type;
            FrameLayout chartLayout;
        }

    }

<span class="nc" id="L331">    public enum ChartType {</span>
<span class="nc" id="L332">        LINE_CHART, COLUMN_CHART, PREVIEW_LINE_CHART, MAP_CHART, TABLE</span>
    }

    public static class ChartDescription {
        private String name;
        private String type;
        private String url;
        private ChartType chartType;

<span class="nc" id="L341">        public String getUrl(){return url;}</span>
<span class="nc" id="L342">        public String getName() {return name;}</span>
<span class="nc" id="L343">        public String getType() {return type;}</span>
<span class="nc" id="L344">        public ChartType getChartType() {return chartType;}</span>

<span class="nc" id="L346">        public ChartDescription(String text1, String text2, String url, ChartType chartType) {</span>
<span class="nc" id="L347">            this.name = text1;</span>
<span class="nc" id="L348">            this.type = text2;</span>
<span class="nc" id="L349">            this.url = url;</span>
<span class="nc" id="L350">            this.chartType = chartType;</span>
<span class="nc" id="L351">        }</span>
    }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.4.201502262128</span></div></body></html>