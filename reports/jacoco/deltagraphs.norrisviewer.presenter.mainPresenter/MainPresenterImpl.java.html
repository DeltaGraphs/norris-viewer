<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../resources/report.css" type="text/css"/><link rel="shortcut icon" href="../resources/report.gif" type="image/gif"/><title>MainPresenterImpl.java</title><link rel="stylesheet" href="../resources/prettify.css" type="text/css"/><script type="text/javascript" src="../resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">app</a> &gt; <a href="index.source.html" class="el_package">deltagraphs.norrisviewer.presenter.mainPresenter</a> &gt; <span class="el_source">MainPresenterImpl.java</span></div><h1>MainPresenterImpl.java</h1><pre class="source lang-java linenums">package deltagraphs.norrisviewer.presenter.mainPresenter;


import android.app.AlertDialog;
import android.content.Context;
import android.content.DialogInterface;
import android.text.InputType;
import android.widget.EditText;

import java.util.Observable;
import java.util.Observer;

import deltagraphs.norrisviewer.model.pageModel.*;
import deltagraphs.norrisviewer.presenter.SocketManager;
import deltagraphs.norrisviewer.view.mainView.MainActivity;
import deltagraphs.norrisviewer.view.mainView.MainView;


/*
 * Name : MainPresenterImpl.java
 * Module : norrisviewer::presenter::mainPresenter
 * Location : norrisviewer\presenter\mainPresenter
 *
 * History :

 * Version Date Programmer Description
 * ===============================================================
 *
 * 1.0.0 2015-06-21 Matteo Furlan Approve
 *
 * 0.4.0 2015-06-18 Enrico Savoca Verify
 *
 * 0.3.2 2015-05-21 Davide Trivellato Added methods isConnected() and boolean isSocketNull()
 *
 * 0.3.1 2015-05-21 Davide Trivellato Fixes to connection methods
 *
 * 0.3.0 2015-05-20 Davide Trivellato Major changes to the whole class
 *
 * 0.2.0 2015-05-19 Davide Trivellato Add dialog to insert URl
 *
 * 0.1.0 2015-05-19 Davide Trivellato Coding of all methods and attributes
 *
 * 0.0.1 2015-05-19 Davide Trivellato Creation of the file
 *
 * ===============================================================
 *
 */

public class MainPresenterImpl implements MainPresenter, Observer {

    protected SocketManager mainSocket;
    public MainView mainView;

    /* MainPresenterImpl will observe the changes on PageModel, according to the observer design pattern.*/
<span class="fc" id="L55">    protected PageModel pageModel = new PageModelImpl(this);</span>

    /* constructor of MainPresenterImpl. It requires an activity to be instatiated properly.
    The object will be associated to the activity. A new socket is created. */
<span class="fc" id="L59">    public MainPresenterImpl(MainView view) {</span>
<span class="fc" id="L60">        mainSocket = new SocketManager();</span>
<span class="fc" id="L61">        mainView = view;</span>
<span class="fc" id="L62">    }</span>

    /* This method is called when a new connection must be established.
    The socket is put to listen for some events that will arrive when the connection is started.
    For each type of event a different path of instructions will be executed, in order to set,
    update or delete some informations. */
    public void setUpSocket(String url) {
<span class="fc" id="L69">        mainSocket.setSocketUrl(url);</span>
<span class="fc" id="L70">        startListening();</span>
<span class="fc" id="L71">        mainSocket.startConnection();</span>
<span class="fc" id="L72">    }</span>

    // the pageModel will be reinitialized.
    public void reinitializePageList() {
<span class="fc" id="L76">        pageModel = new PageModelImpl(this);</span>
<span class="fc" id="L77">    }</span>

    /* the following method is used to create a new dialog. An URL is set as default.
    when the user will press the &quot;ok&quot; button of this dialog on the app activity, a new socket
    connection will be established. */
    public AlertDialog showDialog(final Context context) {
<span class="nc" id="L83">        AlertDialog.Builder builder = new AlertDialog.Builder(context);</span>
<span class="nc" id="L84">        builder.setTitle(&quot;Insert source URL&quot;);</span>

        // Set up the input
<span class="nc" id="L87">        final EditText input = new EditText(context);</span>
        // Specify the type of input expected; this, for example, sets the input as a password, and will mask the text
<span class="nc" id="L89">        input.setInputType(InputType.TYPE_CLASS_TEXT);</span>
        //input.setText(&quot;http://norris-nrti-dev.herokuapp.com/page1/map1&quot;);
<span class="nc" id="L91">        input.setText(mainSocket.getSocketUrl());</span>
<span class="nc" id="L92">        builder.setView(input);</span>

        // Set up the buttons
<span class="nc" id="L95">        builder.setPositiveButton(&quot;OK&quot;, new DialogInterface.OnClickListener() {</span>
            @Override
            public void onClick(DialogInterface dialog, int which) {
                String newUrl = input.getText().toString();
                String oldUrl = mainSocket.getSocketUrl();
                if ((!mainSocket.isConnected()) ||
                        ((mainSocket.isConnected()) &amp;&amp; (!(newUrl.equals(oldUrl))))) {
                    pageModel.removeObservers();
                    mainSocket.stopConnection();
                    mainSocket = new SocketManager();
                    reinitializePageList();
                    setUpSocket(input.getText().toString());
                }

            }
        });
<span class="nc" id="L111">        builder.setNegativeButton(&quot;Cancel&quot;, new DialogInterface.OnClickListener() {</span>
            @Override
            public void onClick(DialogInterface dialog, int which) {
                dialog.cancel();
            }
        });

<span class="nc" id="L118">        AlertDialog dialog = builder.show();</span>
<span class="nc" id="L119">        return dialog;</span>
    }

    public void stopListening(){
<span class="nc" id="L123">        mainSocket.stopListening(&quot;configPageList&quot;);</span>
<span class="nc" id="L124">        mainSocket.stopListening(&quot;insertPage&quot;);</span>
<span class="nc" id="L125">        mainSocket.stopListening(&quot;updatePage&quot;);</span>
<span class="nc" id="L126">        mainSocket.stopListening(&quot;insertGraph&quot;);</span>
<span class="nc" id="L127">        mainSocket.stopListening(&quot;updateGraph&quot;);</span>
<span class="nc" id="L128">    }</span>

    public void startListening(){
<span class="fc" id="L131">        mainSocket.startListening(&quot;configPageList&quot;, (MainActivity) mainView, pageModel);</span>
<span class="fc" id="L132">        mainSocket.startListening(&quot;insertPage&quot;, (MainActivity) mainView, pageModel);</span>
<span class="fc" id="L133">        mainSocket.startListening(&quot;updatePage&quot;, (MainActivity) mainView, pageModel);</span>
<span class="fc" id="L134">        mainSocket.startListening(&quot;insertGraph&quot;, (MainActivity) mainView, pageModel);</span>
<span class="fc" id="L135">        mainSocket.startListening(&quot;updateGraph&quot;, (MainActivity) mainView, pageModel);</span>
<span class="fc" id="L136">    }</span>

    //when called, the socket connection is stopped
    @Override
    public void stopConnection() {
<span class="fc" id="L141">        mainSocket.stopConnection();</span>
<span class="fc" id="L142">    }</span>

    //when called, the socket connection is started
    @Override
    public void startConnection() {
<span class="fc" id="L147">        mainSocket.startConnection();</span>
<span class="fc" id="L148">    }</span>

    // it returns true if the socket is connected.
    @Override
    public boolean isConnected() {
<span class="fc" id="L153">        return mainSocket.isConnected();</span>
    }

    // it returns true if the socket hasn't been instatiated.
    @Override
    public boolean isSocketNull() {
<span class="fc" id="L159">        return mainSocket.isNull();</span>
    }

    /* This object is an observer of the page model. When there are some changes on it, a signal is sent
    to this object and the following method is called. Its aim is to set or update informations that are
    shown on the activity. All of these informations are extracted from the model.*/
    @Override
    public void update(Observable observable, Object data) {
<span class="fc" id="L167">        mainView.updatePagesList(pageModel);</span>
<span class="fc" id="L168">    }</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.4.201502262128</span></div></body></html>